# WebRTC

출처 [WebRTC는 어떻게 실시간으로 데이터를 교환할 수 있을까? - 재그지그의 개발 블로그 (wormwlrm.github.io)](https://wormwlrm.github.io/2021/01/24/Introducing-WebRTC.html)



### 정의(MDN의 WebRTC 문서)

- 웹 애플리케이션과 사이트가 중간자 없이 브라우저 간에 오디오나 영상 미디어를 포착하고 마음대로 스트림 할 뿐 아니라, 임의의 데이터도 교환할 수 있도록 하는 기술

요약하자면, 드라이버나 플러그인 없이 웹 브라우저 간 P2P 연결을 통해 데이터 교환을 가능하게 하는 기술

음성 통화, 영상 통화, 파일 공유, 라이브 스트리밍, 화면 공유 등이 해당 기술을 이용함



### P2P 절차

1. 브라우저간 P2P 커뮤니케이션 동의
2. 서로 주소 공유
3. 보안 사항 및 방화벽 우회
4. 멀티미디어 데이터를 실시간으로 교환



### NAT 트래버셜

방화벽, NAT(여러 대의 컴퓨터가 하나의 공인 IP를 공유), DHCP(유휴 상태의 IP를 일시적으로 임대 받음) 등의 이유로 공인 IP가 일반적으로 할당 되어 있지 않음

때문에 공인 IP뿐 아니라 사설 IP주소까지 알아햐함

라우터가 NAT 역할을 하고, 공인 IP와 포트 번호를 확인해 사설 IP들을 적절히 매핑시킴, 방화벽이 있을 경우 때문에 NAT 트래버셜(라우터를 통과해서 연결할 방법을 찾음) 과정을 거져야함



### STUN, TURN

NAT 트래버셜 작업은 STUN(session Traversal Utilities for NAT) 서버에서 이루어짐

STUN 방식: 단말이 자신의 공인 IP 주소와 port를 확인하는 과정에 대한 프로토콜

STUN 서버를 향해 요청을 보낼 경우, STUN 서버는 NAT 뒤에 있는 Peer들 서로 연결할 수 있도록 공인 IP와 포트를 찾아줌

STUN 서버를 통해 자신의 주소를 찾지 못할 경우, TURN(Traversal Using Relay NAT) 서버를 대안으로 이용

TURN 방식: 네트워크 미디어를 중개하는 서버를 이용하는 것(엄밀히 보면 중간 서버가 있기에 P2P 통신이 아님)



### ICE와 Candidate

Candidate: 획득한 IP 주소와 프로토콜, PORT 조합으로 구성된 연결 가능한 네트워크 주소

일반적으로 얻는 주소

- 자신의 사설 IP와 포트 넘버
- 자신의 공인 IP와 포트 넘버 (STUN, TURN 서버로부터 획득 가능)
- TURN 서버의 IP와 포트 넘버 (TURN 서버로부터 획득 가능)

ICE(Interactive Connectivity Establishment): 두 개의 단말이 P2P 연결을 가능하게 하도록 최적의 경로를 찾아주는 프레임워크

위의 모든 과정은 ICE에서 이루어짐



### SDP

이제 남은 것은 미디어 관련 정보 교환

SDP(Session Description Protocol): 스트리밍 미디어의 해상도, 형식, 코덱 등의 멀티미디어 컨텐츠의 초기 인수를 설명하기 위해 채택한 프로토콜

제안 응답 모델을 갖고 있음(미디어 스트림 교환 제안 시 상대 응답 기다림)

그 후 응답 받게 될 시, Peer가 수집한 ICE 후보 중 최적 경로를 결정, 협상하는 프로세스 발생

수집한 ICE 후보들로 패킷을 보내고 지연 시간이 적고 안정적인 경로 찾음



### Signaling

사용할 프로토콜, 채널, 미디어 코덱 및 형식, 데이터 전송 방법, 라우팅 정보와 NAT 통과 방법을 포함한 통신 규격을 교환하기 위해 두 장치의 제어 정보를 교환하는 과정

주로 웹 소켓(Web Socket)이나 서버 전송 이벤트(Server-sent Event) 방법을 적용해 서버 구축함